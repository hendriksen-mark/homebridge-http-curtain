<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>homebridge-http-curtain</title><meta name="description" content="Documentation for homebridge-http-curtain"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">homebridge-http-curtain</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>homebridge-http-curtain</h1></div><div class="tsd-panel tsd-typography"><p><a href="https://travis-ci.com/QuickSander/homebridge-http-curtain"><img src="https://travis-ci.com/QuickSander/homebridge-http-curtain.svg?branch=master" alt="Build Status"></a>
<a href="https://github.com/semantic-release/semantic-release"><img src="https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg" alt="semantic-release"></a>
<a href="https://badge.fury.io/js/homebridge-http-curtain"><img src="https://badge.fury.io/js/homebridge-http-curtain.svg" alt="npm version"></a>
<a href="https://github.com/homebridge/homebridge/wiki/Verified-Plugins"><img src="https://badgen.net/badge/homebridge/verified/purple" alt="verified-by-homebridge"></a></p>
<h1 id="homebridge-http-curtain" class="tsd-anchor-link">homebridge-http-curtain<a href="#homebridge-http-curtain" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This <a href="https://github.com/homebridge/homebridge">Homebridge</a> plugin can be used to integrate your curtain which has an HTTP api into HomeKit. This controller supports push notification <em>without</em> the need for HomeBridge to periodically pull the curtain position value. There are a few other HTTP based curtain / window blinds
plugins available, but I have not found any yet that does not poll the curtain controller continuously for position or state updates.</p>
<p><em>This is a fork of Supereg's <a href="https://github.com/Supereg/homebridge-http-temperature-sensor">homebridge-http-temperature-sensor</a> modified to function as an curtain controller.</em></p>
<p>Features:</p>
<ul>
<li>Set target position (0-100).</li>
<li>Position change updates: push (efficient / less network and Homebridge load) or pull (easy to configure).</li>
<li>Retrieve current position.</li>
<li>Send identify request (via Eve Home app) to locate your curtain.</li>
</ul>
<h2 id="requirements" class="tsd-anchor-link">Requirements<a href="#requirements" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>Homebridge v2.0.0 or later (works with v1.8+ but optimized for v2+)</li>
<li>Node.js 16.13.0 or later</li>
</ul>
<h2 id="modern-homebridge-api" class="tsd-anchor-link">Modern Homebridge API<a href="#modern-homebridge-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This plugin uses the modern Homebridge API with ES6 classes and Promise-based characteristic handlers for best performance and compatibility with Homebridge v2+.</p>
<h2 id="installation" class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>First of all you need to have <a href="https://github.com/homebridge/homebridge">Homebridge</a> installed. Refer to the repo for
instructions.<br>
Then run the following command to install <code>homebridge-http-curtain</code></p>
<pre><code><span class="hl-0">sudo</span><span class="hl-1"> </span><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">install</span><span class="hl-1"> -</span><span class="hl-0">g</span><span class="hl-1"> </span><span class="hl-0">homebridge</span><span class="hl-1">-</span><span class="hl-0">http</span><span class="hl-1">-</span><span class="hl-0">curtain</span>
</code><button>Copy</button></pre>

<h2 id="updating-the-curtain-position-in-homekit" class="tsd-anchor-link">Updating the curtain position in HomeKit<a href="#updating-the-curtain-position-in-homekit" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <em>'CurrentPosition'</em> characteristic from the <em>'WindowCovering'</em> service has the permission to <code>notify</code> the
HomeKit controller of state changes.
<code>homebridge-http-curtain</code> supports two ways to send window blinds/curtain position changes to HomeKit.</p>
<h4 id="the-pull-way" class="tsd-anchor-link">The 'pull' way:<a href="#the-pull-way" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The 'pull' way is probably the easiest to set up and supported in every scenario. <code>homebridge-http-curtain</code>
requests the value of the curtain/window blind in an specified interval (pulling) and sends the value to HomeKit.<br>
Look for <code>pullInterval</code> in the list of configuration options if you want to configure it.</p>
<h4 id="the-push-way" class="tsd-anchor-link">The 'push' way:<a href="#the-push-way" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When using the 'push' concept the HTTP device itself sends the updated value itself to <code>homebridge-http-curtain</code>
whenever the value changes. This is more efficient as the new value is updated instantly and
<code>homebridge-http-curtain</code> does not need to make needless requests when the value didn't actually change.
However because the http device needs to actively notify the <code>homebridge-http-curtain</code> plugin there is more
work needed to implement this method into your http device.<br>
How to implement the protocol into your http device can be read in the chapter <a href="#notification-server"><strong>Notification Server</strong></a></p>
<h2 id="configuration" class="tsd-anchor-link">Configuration<a href="#configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The configuration can contain the following properties:</p>
<ul>
<li><code>name</code> &lt;string&gt; <strong>required</strong>: Defines the name which is later displayed in HomeKit</li>
<li><code>getCurrentPosUrl</code> &lt;string | <a href="#urlobject">urlObject</a>&gt; <strong>required</strong>: Defines the url
(and other properties when using an urlObject) to query the current position from the curtain.
It expects the http server to return a integer ranging from 0-100 (step 1) leaving out any html markup when no <code>getCurrentPosRegEx</code>
is provided.</li>
<li><code>getCurrentPosRegEx</code> &lt;string&gt; <strong>optional</strong>: A regular expression from which the first matched group determines the current position.</li>
<li><code>getPositionStateUrl</code> &lt;string | <a href="#urlobject">urlObject</a>&gt; <strong>optional</strong>: Defines the url
(and other properties when using an urlObject) to query the current state from the curtain.
It expects the http server to return a integer '0' (Closing), '1' (Opening) or '2' (Idle) leaving out any html markup.
Note that Homekit ignores this state as it rather compares <em>CurrentPosition</em> with <em>TargetPosition</em>.</li>
<li><code>setTargetPosUrl</code> &lt;string | <a href="#urlobject">urlObject</a>&gt; <strong>required</strong>: Defines the url
(and other properties when using an urlObject) to set the target position at the curtain.
Any <code>%d</code> format specifier will be replaced by the requested target position.</li>
<li><code>getTargetPosUrl</code> &lt;string | <a href="#urlobject">urlObject</a>&gt; <strong>optional</strong>: Defines the url
(and other properties when using an urlObject) to retrieve the target position at the curtain.</li>
<li><code>getTargetPosRegEx</code> &lt;string&gt; <strong>optional</strong>: A regular expression from which the first matched group determines the target position.</li>
<li><code>identifyUrl</code> &lt;string | <a href="#urlobject">urlObject</a>&gt; <strong>optional</strong>: URL to call when the HomeKit identify action is requested.</li>
<li><code>pullInterval</code> &lt;integer&gt; <strong>optional</strong>: The property expects an interval in <strong>milliseconds</strong> in which the plugin
pulls updates from your http device. For more information read <a href="#the-pull-way">pulling updates</a>.</li>
<li><code>invertPosition</code> &lt;boolean&gt; <strong>optional</strong>: True: interpret 0% as fully open and 100% as fully closed.</li>
</ul>
<p>Below is an example configuration. One URL is using a simple string URL and the other is using an urlObject.<br>
Both configs can be used for a basic plugin configuration.</p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;accessories&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;My Curtain&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;notificationID&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;my-http-curtain&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;getCurrentPosUrl&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">            </span><span class="hl-2">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;http://localhost:8000/CurrentPos&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">&quot;method&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;GET&quot;</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;getPositionStateUrl&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">            </span><span class="hl-2">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;http://localhost:8000/State&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">&quot;method&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;GET&quot;</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;setTargetPosUrl&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">            </span><span class="hl-2">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;http://localhost:8000/setTargetPos/?Pos=%d&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">&quot;method&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;GET&quot;</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;getTargetPosUrl&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">            </span><span class="hl-2">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;http://localhost:8000/getTargetPos&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">&quot;method&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;GET&quot;</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;identifyUrl&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">            </span><span class="hl-2">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;http://localhost:8000/identify&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-2">&quot;method&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;GET&quot;</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;pullInterval&quot;</span><span class="hl-1">: </span><span class="hl-4">5000</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;invertPosition&quot;</span><span class="hl-1">: </span><span class="hl-5">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;accessory&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;HttpCurtain&quot;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h4 id="urlobject" class="tsd-anchor-link">UrlObject<a href="#urlobject" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>A urlObject can have the following properties:</p>
<ul>
<li><code>url</code> &lt;string&gt; <strong>required</strong>: Defines the url pointing to your http server</li>
<li><code>method</code> &lt;string&gt; <strong>optional</strong> (Default: <strong>&quot;GET&quot;</strong>): Defines the http method used to make the http request</li>
<li><code>body</code> &lt;string&gt; <strong>optional</strong>: Defines the body sent with the http request</li>
<li><code>auth</code> &lt;object&gt; <strong>optional</strong>: If your http server uses basic authentication you can specify your credential in this
object. When defined the object must contain the following properties:
<ul>
<li><code>username</code> &lt;string&gt;</li>
<li><code>password</code> &lt;string&gt;</li>
</ul>
</li>
<li><code>headers</code> &lt;object&gt; <strong>optional</strong>: Using this object you can define any http headers which are sent with the http
request. The object must contain only string key value pairs.</li>
</ul>
<p>Below is an example of an urlObject containing all properties:</p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;http://example.com:8080&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;method&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;GET&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;body&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;exampleBody&quot;</span><span class="hl-1">,</span><br/><br/><span class="hl-1">  </span><span class="hl-2">&quot;auth&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;username&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;yourUsername&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;password&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;yourPassword&quot;</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-1">  </span><span class="hl-2">&quot;headers&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;Content-Type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;text/html&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="notification-server" class="tsd-anchor-link">Notification Server<a href="#notification-server" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>homebridge-http-curtain</code> can be used together with
<a href="https://github.com/Supereg/homebridge-http-notification-server">homebridge-http-notification-server</a> in order to receive
updates when the state changes at your home automation device. For details on how to implement those updates and how to
install and configure <code>homebridge-http-notification-server</code>, please refer to the
<a href="https://github.com/Supereg/homebridge-http-notification-server">README</a> of that repository.</p>
<p>Down here is an example on how to configure <code>homebridge-http-curtain</code> to work with your implementation of the
<code>homebridge-http-notification-server</code>.</p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;accessories&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;accessory&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;HttpCurtain&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;Living Room Curtain&quot;</span><span class="hl-1">,</span><br/><br/><span class="hl-1">          </span><span class="hl-2">&quot;notificationID&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;my-curtain&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;notificationPassword&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;SuperSecretPassword&quot;</span><span class="hl-1">,</span><br/><br/><span class="hl-1">          </span><span class="hl-2">&quot;getUrl&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;http://localhost/api/pos&quot;</span><br/><span class="hl-1">        }   </span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<ul>
<li><code>notificationID</code> is an per Homebridge instance unique id which must be included in any http request.</li>
<li><code>notificationPassword</code> is <strong>optional</strong>. It can be used to secure any incoming requests.</li>
</ul>
<p>To get more details about the configuration have a look at the
<a href="https://github.com/Supereg/homebridge-http-notification-server">README</a>.</p>
<p><strong>Available characteristics (for the POST body)</strong></p>
<p>Down here are all characteristics listed which can be updated with an request to the <code>homebridge-http-notification-server</code></p>
<ul>
<li><code>characteristic</code> &quot;CurrentPosition&quot;: expects an integer <code>value</code> in a range of 0 up to and including 100.</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#homebridge-http-curtain"><span>homebridge-<wbr/>http-<wbr/>curtain</span></a><ul><li><a href="#requirements"><span>Requirements</span></a></li><li><a href="#modern-homebridge-api"><span>Modern <wbr/>Homebridge <wbr/>API</span></a></li><li><a href="#installation"><span>Installation</span></a></li><li><a href="#updating-the-curtain-position-in-homekit"><span>Updating the curtain position in <wbr/>Home<wbr/>Kit</span></a></li><li><ul><li><ul><li><a href="#the-pull-way"><span>The &#39;pull&#39; way:</span></a></li><li><a href="#the-push-way"><span>The &#39;push&#39; way:</span></a></li></ul></li></ul></li><li><a href="#configuration"><span>Configuration</span></a></li><li><ul><li><ul><li><a href="#urlobject"><span>Url<wbr/>Object</span></a></li></ul></li></ul></li><li><a href="#notification-server"><span>Notification <wbr/>Server</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">homebridge-http-curtain</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
